#!/bin/bash
# 
# Installation script for Matew - Make Album The Easy Way
#
# Do NOT edit this file.

# Script details (Do NOT edit)
SCRIPT_PATH="$(pwd)"
SCRIPT_VERSION="2.0"

# Configuration parameters (Do NOT edit)
RBINS="/usr/bin"
RCONF="/usr/share"
RDOCS="/usr/share/doc"
RMAN="/usr/share/man/man1"

# Checking if you have root access
if [ $(id -u) -ne 0 ]; then
  echo -e "\n\033[1mWARNING\\033[0m: You must have root access (uid=0) to install Matew\n"
  exit 1
fi

# Functions
help() {
  cat << HELP
Usage: $(basename $0) [option]

Run this script with no option and it will install the Matew files
onto your system.

option:
  -h                    print this message
HELP

exit 0
}

err() {
  # Checking if ImageMagick suite is available and, if not display
  # a warning message
  echo -e "\n\033[1mWARNING\\033[0m: Matew depends on both convert and identify, two command line tools. \n\
         Install the ImageMagick package and come back.\n"
  exit 1
}

main() {
  which convert 1>/dev/null 2>&1 || err
  which identify 1>/dev/null 2>&1 || err

  SCRIPT_PATH=$(echo ${SCRIPT_PATH%/})

  # Installing the executable files into $RBINS
  install $SCRIPT_PATH/src/matew $RBINS/matew
  install $SCRIPT_PATH/src/matew-cleanup $RBINS/matew-cleanup
  install $SCRIPT_PATH/src/matew-wizard $RBINS/matew-wizard

  # Copying language and style files to $RCONF/matew
  if [ ! -d $RCONF/matew ]; then
    rm -rf $RCONF/matew 2>/dev/null
    mkdir -m 755 $RCONF/matew
  fi
  cp -rf $SCRIPT_PATH/src/languages $RCONF/matew
  cp -rf $SCRIPT_PATH/src/styles $RCONF/matew
  chmod 755 $RCONF/matew/*
  chmod 755 $RCONF/matew/languages
  chmod 755 $RCONF/matew/styles

  # Copying documentation files to $RDOCS/matew-$SCRIPT_VERSION
  rm -rf $RDOCS/matew-* 2>/dev/null
  mkdir -m 755 $RDOCS/matew-$SCRIPT_VERSION
  for FILE in $(ls -1 $SCRIPT_PATH/doc | grep -v "man") ; do
    cp -rf $SCRIPT_PATH/doc/$FILE $RDOCS/matew-$SCRIPT_VERSION
  done

  # Copying manual page $RMAN
  rm -rf $RMAN/matew.1.gz 2>/dev/null
  cp -rf $SCRIPT_PATH/doc/man/matew.1.gz $RMAN

  echo -e "\n\033[1mMatew files installed successfully!\033[0m\n\
Run matew-wizard and read instructions.\n"

  exit 0
}

# Parse option flags
if [ ! -z "$1" ]; then
  help
else
  main
fi
